# 智形合一小程序

---

<img src="https://raw.githubusercontent.com/raosirui/Picture/main/markdown/202411212130617.png" alt="image-20241121213016554" style="zoom:50%;" />

- 创业项目，单人负责小程序后端设计开发
- 实现用户登录小程序进行球馆场地预约、学习运动教学视频文章。工作人员对场馆场地、订单、用户、运动教学内容进行管理



**专业技能**

**JavaSE基础：**熟悉常用数据结构底层原理，熟悉集合，封装，继承和多态等；了解线程安全，线程池等内容；了解JVM内存结构，类加载机制和垃圾回收算法等。
**框架：**熟悉使用Spring全家桶，MyBatis-Plus等主流开发框架，了解IOC，AOP等原理。
**微服务：**熟悉Nacos，OpenFeign，Gateway，Seata，Sentinel等Spring Cloud微服务组件的使用。
**协议：**熟悉TCP/IP网络模型，熟悉HTTP、TCP/UDP，DNS等常见协议.
**MySQL：**熟练使用sql语句，熟悉sql优化，对事务，索引，锁机制和日志有一定了解。
**Redis**：熟悉Redis的使用，了解Redis的缓存更新策略，缓存击穿，缓存穿透，缓存雪崩等问题的原因及解决方案，了解Redis常用的五种数据类型及底层数据结构，了解Redis集群搭建和多级缓存。
**消息队列：**熟悉RabbitMQ的基本使用，了解集群搭建，死信队列和保证消息可靠性的方法
**设计模式：**熟悉单例，策略，工厂，观察者，装饰器等常用设计模式，及相关的设计原则。
**Linux：**了解linux系统及常用命令的使用。



**项目经历**

**技术选型：**Spring Cloud、Spring Security OAuth2、MySQL、Elasticsearch、MinIO、Redis、XXL-JOB、Redisson、RabbitMQ、Canal、微信支付、ZXing

**核心架构：**包含球馆预约模块、运动教学模块、媒资管理模块、认证授权模块、搜索模块、订单支付模块。

**项目内容**：

- 运动教学模块：后台管理通过分布式事务和Canal实现**四位一体**的数据同步存储方案，为**保证AP**采取本地消息表+任务调度分片广播策略，同时使用Sentinel实现**熔断降级**增加系统可用性
- 媒资模块：采用MinI0分布式文件系统，针对**上传视频**文件进行分块合并、断点续传、md5值校验，上传完毕经FFmepg进行视频编码，使用XXL-job、Redisson进行编码的**多线程处理**优化速度。
- 搜索模块：使用ElasticSearch实现根据多级分类搜索、关键字**全文检索**、难度等级排序、高亮显示
- 认证授权模块：使用**SpringSecurityOAuth2**框架结合JWT令牌，采用微信小程序授权码模式单点登录，基于RBAC模型实现运营人员与普通用户权限控制。
- 订单支付模块：调取微信小程序支付API，使用**消息队列**RabbitMQ完成支付成功后的更新订单信息、NotifyUrl通知支付状态及ZXing生成订单核销二维码操作。利用RabbitMQ**延迟消息**实现订单十分钟未支付超时删除。



# 1、项目概述

智形合一小程序是一个2B2C的球馆运动服务平台项目。用户可登录小程序进行球馆场地预约、学习运动教学视频文章。工作人员可对场馆场地、订单、用户、运动教学内容进行管理。

项目包含球馆预约模块、运动教学模块、媒资管理模块、认证授权模块、搜索模块、订单支付模块。

技术架构：Spring Cloud、Spring Security OAuth2、MySQL、Elasticsearch、MinIO、Redis、XXL-JOB、Redisson、RabbitMQ、Canal、微信支付、ZXing

我负责小程序后端所有的设计开发和小程序UI设计。



# 2、球馆预约模块

**用户：**

- 选择场地

  - 选择球馆

  - 选择运动

  - 选择时间段

- 生成订单

  - 订单详情

  - 支付按钮



**体育馆运营：**

- 场地管理  CRUD
- 订单管理  
  - 退款
  - 查询
  - 核销订单







# 3、运动教学模块

**用户：**

通过菜单或搜索查询教学  --> 菜单树状查询（表自连接/递归查询）  

- -->  运动大类（球类 田径 健身 体测）
  - --> 具体运动（羽毛球 篮球）
    - -> 具体动作（发球 高远球）

-->  运动教学内容 （视频、图片、文字 从媒资模块获取）

**开发运营：**

- 菜单管理
- 教学内容管理（CRUD 分布式事务同步到DB、Redis、ES、MinIO）

​	CP：高一致性 金融 Seata的XA/TA模式

​	AP：MQ、本地消息表+任务调度分片广播、TCC

​	Sentinal 熔断降级









# 4、媒资管理模块

- 上传图片
  - 前端上传到媒资模块，分别保存到DB和MinIO（事务）
- 上传视频   
  - 断点续传
  - 分块合并
  - md5码校验
- 视频处理
  - FFmpeg转码 （多线程处理：XXL-job、Redisson)
- 绑定媒资









# 5、搜索模块

Elastic Search

搜索运动教学内容：

- 多级分类搜索
- 关键字全文检索
- 难度等级搜索排序

实现分页查询（前端）、高亮显示

使用Canal数据同步





# 6、认证授权模块

Spring Security OAuth2

在Geteway里接收所有请求，只用鉴定JWT是否合法

单一微信小程序方式登录（授权码模式）

用户授权（RBAC）：普通人员、运营人员、开发Admin

补充：细粒度授权：每个运营只能查看自己场馆下的信息和用户

Admin和运营人员可进行用户管理







# 7、订单支付模块

用户：订单点击支付 --> 调取VX小程序/JSAPI支付接口  --> 请求支付（第三方生成订单） -->  输入密码  --> 支付完成

-> MQ  -->

- 支付通知NotifyUrl 
- 更新订单

查看订单 --> 到场订单核销二维码













# 8、其他问题

